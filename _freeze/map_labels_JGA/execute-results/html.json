{
  "hash": "5f5f3e6b791152b64aa055b9a65d1e0f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Not overlapping labels JGA\"\noutput: html_document\ndate: \"2024-11-19\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n#library(leaflet.extras)\nlibrary(leaflet)\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(htmltools)\nsource(\"R/map_functions.R\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at E:/UNI/6. SEVILLA/99. OTROS/2024_11_19 WEB Ecoinformatica/new_website\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nmember.table <- gsheet::gsheet2tbl(\"1tRlCcIxurHIDg-CCHsFFbkD3e4YkiDlA3PkFlTcBlk8\") |>\n  format_member_table()\n\ncoords.table <- readr::read_csv(\"institutioncoords.csv\") |> \n  update_coord_table(member.table= member.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 62 Columns: 3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): afil_id\ndbl (2): lon, lat\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nmember.table.coords <- left_join(member.table, coords.table) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(afil_id)`\n```\n\n\n:::\n\n```{.r .cell-code}\npoints <- member.table.coords |> \n  #filter(Afiliación==\"Universidad Autónoma de Madrid\") |> \n  filter(!is.na(lon)) |> \n  st_as_sf(coords = c(\"lon\", \"lat\"))\n\nleaflet(points) |> \n  addTiles() |> \n  addMarkers(popup = points, \n             label = ~(Nombre),\n             labelOptions = labelOptions(zoomAnimation = T),\n             clusterOptions = markerClusterOptions())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in zoomAnimationWarning(): zoomAnimation has been deprecated by Leaflet.js. See https://github.com/Leaflet/Leaflet/blob/master/CHANGELOG.md#api-changes-5\nignoring 'zoomAnimation' parameter\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-a9fba9c1b94e56119c38\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a9fba9c1b94e56119c38\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addMarkers\",\"args\":[[37.38073175,37.4119228],[-5.990264998425345,-6.005817705690609],null,null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},{\"Marca temporal\":[\"19/11/2024 16:25:17\",\"19/11/2024 17:23:41\"],\"Dirección de correo electrónico\":[\"ig.ramosgutierrez@gmail.com\",\"equintero1@us.es\"],\"Nombre\":[\"Ignacio\",\"Elena Quintero\"],\"Área/Departamento\":[\"Dpto. de biología Vegetal y Ecologia\",\"bla\"],\"Institución\":[\"Universidad de Sevilla\",\"Estación Biologica de Doñana\"],\"Ciudad\":[\"Sevilla\",\"Sevilla\"],\"País\":[\"España\",\"España\"],\"inst\":[\"Universidad+de+Sevilla\",\"Estación+Biologica+de+Doñana\"],\"city\":[\"Sevilla\",\"Sevilla\"],\"country\":[\"España\",\"España\"],\"afil_id\":[\"Universidad de Sevilla_Sevilla_España\",\"Estación Biologica de Doñana_Sevilla_España\"],\"geometry\":[{\"type\":\"Point\",\"coordinates\":[-5.990264998425345,37.38073175]},{\"type\":\"Point\",\"coordinates\":[-6.005817705690609,37.4119228]}]},null,{\"showCoverageOnHover\":true,\"zoomToBoundsOnClick\":true,\"spiderfyOnMaxZoom\":true,\"removeOutsideVisibleBounds\":true,\"spiderLegPolylineOptions\":{\"weight\":1.5,\"color\":\"#222\",\"opacity\":0.5},\"freezeAtZoom\":false},null,[\"Ignacio\",\"Elena Quintero\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[37.38073175,37.4119228],\"lng\":[-6.005817705690609,-5.990264998425345]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n\n```{.r .cell-code}\n   #addProviderTiles(Esri.WorldGrayCanvas\")\n\n\n# member.filt = member.table |> \n#   select(Nombre, Afiliación)\n# \n# \n# institutions <- member.table |> \n#   distinct(Afiliación) |> \n#   mutate(af = stringr::str_replace_all(Afiliación, \" \", \"+\"),\n#          af = stringr::str_replace_all(af, \",\", \"\"),\n#          af = stringr::str_replace_all(af, \"\\n\", \"+\"))\n# \n# url = paste0(\n#   \"http://nominatim.openstreetmap.org/search?q=\",\n#   institutions$af[2], #\"Universidad+California+Davis\"\n#   \"&limit=9&format=json\")\n# \n# resOSM = fromJSON(url)\n# \n# c(resOSM[[1]]$lon, resOSM[[1]]$lat)\n\n# locateAFF = function(afiliation) {\n#   url = paste0(\n#     \"http://nominatim.openstreetmap.org/search?q=\",\n#     afiliation,\n#     \"&limit=9&format=json\")\n#   resOSM = fromJSON(url)\n#   if(length(resOSM) > 0) {\n#     return(c(resOSM[[1]]$lon, resOSM[[1]]$lat))\n#   } else return(rep(NA,2)) \n# }\n# \n# #Try function:\n# #locateAFF(institutions$af[3])\n# \n# coords <- lapply(institutions$af, locateAFF)\n# \n# df.coords <- t(as.data.frame(coords))\n# \n# institutions$lon <- df.coords[,1]\n# institutions$lat <- df.coords[,2]\n# \n# head(institutions)[,-2]\n# \n# \n# member.complete <- left_join(member.filt, institutions, by = \"Afiliación\")\n```\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\n<link href=\"site_libs/leaflet-markercluster-1.0.5/MarkerCluster.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js\"></script>\n<script src=\"site_libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js\"></script>\n<script src=\"site_libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}